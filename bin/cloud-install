#!/bin/sh

set -e

. /usr/share/cloud-installer/common/common.sh
. /usr/share/cloud-installer/common/maas.sh
. /usr/share/cloud-installer/common/juju.sh
. /usr/share/cloud-installer/common/configure.sh
. /usr/share/cloud-installer/common/multi.sh
. /usr/share/cloud-installer/common/single.sh
. /usr/share/cloud-installer/common/landscape.sh

log="/var/log/cloud-install.log"
( umask 066 && touch "$log" )
set -x
exec 2>> "$log"

trap exitInstall EXIT
trap "" PIPE

#disableBlank

if [ ! -e /etc/.cloud-installed ]; then
	configureInstall
	case $install_type in
	Multi-system)
		multiInstall
		;;
	"Single system")
		singleInstall
		;;
	"Landscape managed")
		landscapeInstall
		;;
	*)
		# install cancelled by user
		exit 1
		;;
	esac
	touch /etc/.cloud-installed
else
	echo "Cloud already installed."
fi
exitInstall
cd "/home/$INSTALL_USER"; exec sudo -H -u "$INSTALL_USER" cloud-status
